-- Main Controller Script

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local playerName = LocalPlayer.Name
local workspaceFolder = "workspace" -- Thư mục lưu file, bạn có thể đổi nếu cần

-- Các đường dẫn script
local scriptA = 'getgenv().Team = "Marines"\nloadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/85e904ae1ff30824c1aa007fc7324f8f.lua"))()'
local scriptB = [[
getgenv().Config = {
    ["Auto Get Cyborg"] = true,
    ["Auto Get Fully Cyborg"] = true
}
repeat wait() until game:IsLoaded() and game.Players.LocalPlayer 
getgenv().Key = "e9162fb60364a89d94d75009" 
loadstring(game:HttpGet("https://raw.githubusercontent.com/obiiyeuem/vthangsitink/main/BananaHub.lua"))()
]]
local scriptC = [[
getgenv().Config = {
    ["Auto Upgrade Race V2-V3"] = true
}
repeat wait() until game:IsLoaded() and game.Players.LocalPlayer 
getgenv().Key = "e9162fb60364a89d94d75009" 
loadstring(game:HttpGet("https://raw.githubusercontent.com/obiiyeuem/vthangsitink/main/BananaHub.lua"))()
]]
local scriptD = [[
getgenv().Config = {
    ["Get Fruit In Inventory Low Beli"] = true,
    ["Auto Raid"] = true 
}
repeat wait() until game:IsLoaded() and game.Players.LocalPlayer 
getgenv().Key = "e9162fb60364a89d94d75009" 
loadstring(game:HttpGet("https://raw.githubusercontent.com/obiiyeuem/vthangsitink/main/BananaHub.lua"))()
]]

-- Hàm kiểm tra Fist of Darkness trong túi đồ
local function hasFistOfDarkness()
    for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
        if item.Name:lower():find("fist of darkness") then
            return true
        end
    end
    return false
end

-- Hàm kiểm tra fragment
local function getFragment()
    local stats = LocalPlayer:FindFirstChild("Data") or LocalPlayer
    return stats:FindFirstChild("Fragments") and stats.Fragments.Value or 0
end

-- Hàm kiểm tra Cyborg
local function hasCyborg()
    local stats = LocalPlayer:FindFirstChild("Data") or LocalPlayer
    return stats:FindFirstChild("Race") and stats.Race.Value == "Cyborg"
end

-- Hàm kiểm tra Cyborg V3
local function hasCyborgV3()
    local stats = LocalPlayer:FindFirstChild("Data") or LocalPlayer
    return stats:FindFirstChild("Race") and stats.Race.Value == "Cyborg" and stats:FindFirstChild("RaceLevel") and stats.RaceLevel.Value == 3
end

-- Hàm lưu trạng thái đã gắn Fist of Darkness
local function saveFistStatus()
    local src = workspaceFolder.."/fist.json"
    local dest = workspaceFolder.."/"..playerName..".json"
    if isfile(src) then
        local data = readfile(src)
        writefile(dest, data)
    end
end

-- Hàm kiểm tra trạng thái đã gắn Fist of Darkness
local function isFistSaved()
    local file = workspaceFolder.."/"..playerName..".json"
    if isfile(file) then
        local data = HttpService:JSONDecode(readfile(file))
        return data.fist == true
    end
    return false
end

-- Hàm hop server (bạn cần thay thế bằng script hop server của bạn)
local function hopServer()
    -- Ví dụ: loadstring(game:HttpGet("link_hop_server"))()
    print("Hopping server...")
end

-- Hàm kiểm tra và chuyển về Sea 2
local function checkAndTravelToSea2()
    local seaIds = {[2753915549] = 1, [4442272183] = 2, [7449423635] = 3}
    local seaTravelCommands = {
        [1] = "TravelMain",       -- Sea 2 → Sea 1
        [2] = "TravelDressrosa",  -- Sea 1 → Sea 2
        [3] = "TravelZou"         -- Sea 2 → Sea 3
    }
    local currentSea = seaIds[game.PlaceId]
    if currentSea ~= 2 then
        local command = seaTravelCommands[2]
        if command then
            pcall(ReplicatedStorage.Remotes.CommF_.InvokeServer, ReplicatedStorage.Remotes.CommF_, command)
            wait(5)
        end
    end
end

-- Main loop
spawn(function()
    while true do
        checkAndTravelToSea2()
        wait(2)
    end
end)

spawn(function()
    while true do
        if hasCyborgV3() then
            print("done Cyborg V3")
            break
        end

        if not isFistSaved() then
            -- Chưa gắn fist, kiểm tra liên tục
            if not hasFistOfDarkness() then
                loadstring(scriptA)()
            else
                saveFistStatus()
                loadstring(scriptB)()
            end
        else
            loadstring(scriptB)()
        end

        if getFragment() < 1000 then
            hopServer()
            loadstring(scriptD)()
        end

        if hasCyborg() then
            hopServer()
            loadstring(scriptC)()
        end

        wait(1)
    end
end)
